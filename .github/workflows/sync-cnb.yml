# .github/workflows/sync-cnb.yml

name: Sync to CNB
on: [push]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Sync via ZIP (No Local History)
        env:
          CNB_TOKEN: ${{ secrets.GIT_PASSWORD }}
          CNB_URL: "cnb.cool/2x.nz/fuwari.git"
          # 显式使用 main.zip
          REPO_ZIP_URL: "https://github.com/afoim/fuwari/archive/refs/heads/main.zip"
        run: |
          # 1. 下载 ZIP
          curl -L -q "$REPO_ZIP_URL" -o repo.zip
          
          # 2. 解压并进入目录
          unzip -q repo.zip
          # 解压出的目录通常是 {repo_name}-{branch_name}
          DIR_NAME=$(find . -maxdepth 1 -type d -name "fuwari-*" | head -n 1)
          cd "$DIR_NAME"
          
          # 3. 初始化 Git 并配置
          git init -q
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # 4. 改写远程仓库为 CNB
          git remote add origin "https://cnb:${CNB_TOKEN}@${CNB_URL}"
          
          # 5. 创建同步提交并强制推送
          git checkout -b main -q
          git add .
          git commit -q -m "sync: commit from GitHub zip"
          git push -f -q origin main
