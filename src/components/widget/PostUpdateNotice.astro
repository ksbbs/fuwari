---
import { Icon } from 'astro-icon/components'

interface Props {
    lastUpdated: string | Date;
}

const { lastUpdated } = Astro.props;
const dateStr = lastUpdated instanceof Date ? lastUpdated.toISOString() : lastUpdated;
---

<div id="outdated-notice" class="hidden mb-6 p-4 rounded-xl bg-[var(--license-block-bg)] border border-[var(--line-divider)] items-center gap-3 text-white/80 onload-animation">
    <div class="h-8 w-8 rounded-lg bg-[var(--primary)] flex items-center justify-center shrink-0">
        <Icon name="material-symbols:info-outline-rounded" class="text-xl text-black/70" />
    </div>
    <div class="text-sm leading-relaxed">
        <span id="outdated-message">正在计算文章时效性...</span>
    </div>
</div>

<script define:vars={{ lastUpdated: dateStr }}>
    function updateNotice() {
        const notice = document.getElementById('outdated-notice');
        const message = document.getElementById('outdated-message');
        if (!notice || !message) return;

        const updatedDate = new Date(lastUpdated);
        const now = new Date();
        
        const diffTime = Math.abs(now - updatedDate);
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

        let statusText = "";
        if (diffDays === 0) {
            statusText = "这篇文章今天刚刚更新，内容非常新鲜。";
        } else {
            statusText = `该文章最后修改于 ${diffDays} 天前，部分技术细节可能已随时间演变，请结合实际情况参考。`;
        }

        message.innerText = statusText;
        
        notice.classList.remove('hidden');
        notice.classList.add('flex');
    }

    updateNotice();

    document.addEventListener('swup:contentReplaced', updateNotice);
</script>
