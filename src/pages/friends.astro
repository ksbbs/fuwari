---
import { siteConfig } from "@/config";
import type { Friend } from "@/types/data";
import LinkSubmitInfo from "@components/misc/LinkSubmitInfo.astro";
import MainGridLayout from "@layouts/MainGridLayout.astro";
import { Icon } from "astro-icon/components";

const friends = Object.values(
	import.meta.glob<Friend>("@/data/friends/*.json", {
		eager: true,
		import: "default",
	}),
);

const breadcrumbSchema = {
	"@context": "https://schema.org",
	"@type": "BreadcrumbList",
	itemListElement: [
		{
			"@type": "ListItem",
			position: 1,
			name: "首页",
			item: Astro.site,
		},
		{
			"@type": "ListItem",
			position: 2,
			name: "友链",
			item: new URL("/friends", Astro.site).toString(),
		},
	],
};
---

<MainGridLayout title="友链">
    <script is:inline slot="head" type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)}></script>
    <div class="card-base p-6 md:p-8">
        <div class="flex items-center gap-2 mb-6">
            <div class="h-8 w-8 rounded-lg bg-[var(--primary)] flex items-center justify-center text-black/70">
                <Icon name="material-symbols:diversity-3" class="text-[1.5rem]">
            </div>
            <h1 class="text-2xl font-bold text-white">友链</h1>
        </div>

        <!-- 申请友链 -->
            <div class="mb-4">
                <LinkSubmitInfo dataType="friends"></LinkSubmitInfo>
            </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {friends.map((friend) => (
                <a href={friend.url} target="_blank" class="friend-card">
                    <div class="flex items-center gap-2">
                        <div class="relative w-5 h-5 rounded overflow-hidden" style={`--theme-hue: ${siteConfig.themeColor.hue}`}>
                            <img src={friend.avatar} loading="lazy" class="w-full h-full object-cover transition-opacity duration-500" alt={`${friend.name}的头像`} />
                        </div>
                        <div class="font-bold text-white">{friend.name}</div>
                    </div>
                    <div class="text-sm text-white/50">{friend.description}</div>
                </a>
            ))}
        </div>



</MainGridLayout>

<style>
    .friend-card {
        @apply border border-black/10 dark:border-white/10 hover:border-black/20 dark:hover:border-white/20 hover:bg-black/5 dark:hover:bg-white/5 transition flex flex-col gap-1 p-4 rounded-lg;
        transition-property: background-color, border-color, scale;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 0.15s;
        transform: translateZ(0);
    }
    
    .friend-card:active {
        scale: .98;
    }
    
    .friend-card:hover .font-bold {
        color: var(--btn-content);
    }
    
    .friend-card:hover .text-sm {
    @apply text-white;
    }

    .friend-card .font-bold,
    .friend-card .text-sm {
        transition-property: color;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 0.15s;
    }
</style>
